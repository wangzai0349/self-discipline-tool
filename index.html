<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔥 打败拖延症 - 你的自律小助手</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- 顶部状态栏 -->
        <header class="top-bar">
            <div class="logo">🔥 打败拖延症</div>
            <div class="date-info" id="dateInfo"></div>
            <div class="quick-stats">
                <span class="qs-item">⚡ 连续 <strong id="streak">0</strong> 天</span>
                <span class="qs-item">🏆 <strong id="totalPoints">0</strong> 积分</span>
                <button id="openPlanBtn" class="btn-plan">📅 周规划</button>
                <button id="openMonthPlanBtn" class="btn-plan">� 月度计划</button>
                <button id="openYearPlanBtn" class="btn-plan">🎯 年度计划</button>
                <button id="openReviewBtn" class="btn-review">🔍 复盘</button>
                <button id="openSyncBtn" class="btn-sync">☁️ 同步</button>
            </div>
        </header>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 左侧：项目统计 + 任务区 -->
            <div class="left-panel">
                <!-- 项目统计 -->
                <section class="project-stats-section">
                    <div class="section-header">
                        <h2>� 项目进度</h2>
                        <button id="manageProjects" class="btn-add" title="管理项目">⚙️</button>
                    </div>
                    <div class="project-filter-tabs" id="projectFilterTabs">
                        <button class="project-tab active" data-project="all">全部</button>
                    </div>
                    <div class="project-progress-list" id="projectProgressList"></div>
                </section>

                <!-- 每日基础任务 -->
                <section class="task-section">
                    <div class="section-header">
                        <h2>📋 每日基础任务</h2>
                        <span class="section-hint">每天都要完成</span>
                    </div>
                    <div class="task-list" id="baseTaskList"></div>
                </section>

                <!-- 当日临时任务 -->
                <section class="task-section">
                    <div class="section-header">
                        <h2>📝 当日任务</h2>
                        <button id="toggleDailyForm" class="btn-add">➕</button>
                    </div>
                    <div class="add-form hidden" id="dailyTaskForm">
                        <select id="dailyTaskProject" class="project-select">
                            <option value="">无项目</option>
                        </select>
                        <input type="text" id="dailyTaskInput" placeholder="添加今日任务" maxlength="50">
                        <select id="dailyTaskPoints">
                            <option value="5">5分</option>
                            <option value="10" selected>10分</option>
                            <option value="15">15分</option>
                        </select>
                        <button id="addDailyTask" class="btn-confirm">添加</button>
                    </div>
                    <div class="task-list" id="dailyTaskList"></div>
                </section>
            </div>

            <!-- 中间：统计区 -->
            <div class="center-panel">
                <!-- 激励语 -->
                <div class="motivation-box">
                    <p id="motivationText">开始你的第一个任务吧！</p>
                </div>

                <!-- 今日统计 - 扇形图 -->
                <div class="stats-card">
                    <h3>📊 今日进度</h3>
                    <div class="chart-container">
                        <div class="pie-chart" id="todayChart">
                            <svg viewBox="0 0 36 36" class="circular-chart">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="circle" id="todayCircle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <text x="18" y="20.35" class="percentage" id="todayPercent">0%</text>
                            </svg>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item"><span class="dot done"></span>已完成 <strong id="todayDone">0</strong></div>
                            <div class="legend-item"><span class="dot pending"></span>未完成 <strong id="todayPending">0</strong></div>
                        </div>
                    </div>
                </div>

                <!-- 本周统计 - 扇形图 -->
                <div class="stats-card">
                    <h3>📈 本周进度</h3>
                    <div class="chart-container">
                        <div class="pie-chart" id="weekChart">
                            <svg viewBox="0 0 36 36" class="circular-chart">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="circle week" id="weekCircle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <text x="18" y="20.35" class="percentage" id="weekPercent">0%</text>
                            </svg>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item"><span class="dot done"></span>已完成 <strong id="weekDone">0</strong></div>
                            <div class="legend-item"><span class="dot pending"></span>未完成 <strong id="weekPending">0</strong></div>
                            <div class="legend-item"><span class="dot perfect"></span>完美天 <strong id="perfectDays">0</strong></div>
                        </div>
                    </div>
                </div>

                <!-- 积分统计 -->
                <div class="stats-card points-card">
                    <h3>💰 积分统计</h3>
                    <div class="points-display">
                        <div class="points-total">
                            <span class="points-num" id="pointsTotal">0</span>
                            <span class="points-label">总积分</span>
                        </div>
                        <div class="points-today">
                            <span class="points-num small" id="pointsToday">+0</span>
                            <span class="points-label">今日获得</span>
                        </div>
                    </div>
                </div>



                <!-- 成就徽章 -->
                <div class="achievements-card">
                    <h3>🎖️ 成就徽章</h3>
                    <div class="badges" id="badges"></div>
                </div>
            </div>

            <!-- 右侧：收入统计 + 未完成汇总 + 完成记录 -->
            <div class="right-panel">
                <!-- 收入记账本 -->
                <section class="income-section">
                    <div class="income-header-main">
                        <h2>💵 收入记账本</h2>
                        <button id="manageIncomeTypes" class="btn-small-icon" title="管理类型">⚙️</button>
                    </div>
                    
                    <!-- 收入目标进度 -->
                    <div class="income-goals-container">
                        <!-- 总收入显示 -->
                        <div class="total-income-display">
                            <span class="total-label">总收入</span>
                            <span class="total-value" id="totalIncomeValue">¥0</span>
                        </div>
                        
                        <!-- 月度目标 -->
                        <div class="income-goal-item">
                            <div class="goal-header">
                                <span class="goal-label">📅 本月目标</span>
                                <button id="setMonthGoal" class="btn-tiny">设置</button>
                            </div>
                            <div class="goal-amount">¥<span id="monthGoal">0</span></div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="monthProgressFill"></div>
                            </div>
                            <div class="goal-stats">
                                <span id="monthIncome">¥0</span>
                                <span id="monthPercent">0%</span>
                            </div>
                        </div>
                        
                        <!-- 年度目标 -->
                        <div class="income-goal-item">
                            <div class="goal-header">
                                <span class="goal-label">🎯 年度目标</span>
                                <button id="setYearGoal" class="btn-tiny">设置</button>
                            </div>
                            <div class="goal-amount">¥<span id="yearGoal">0</span></div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="yearProgressFill"></div>
                            </div>
                            <div class="goal-stats">
                                <span id="yearIncome">¥0</span>
                                <span id="yearPercent">0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 添加收入 -->
                    <div class="income-add-form">
                        <select id="incomeTypeSelect" class="income-type-select"></select>
                        <input type="number" id="incomeInput" placeholder="金额" min="0" step="0.01">
                        <button id="addIncomeBtn" class="btn-confirm">记录</button>
                    </div>
                    
                    <!-- 报表周期切换 -->
                    <div class="report-tabs">
                        <button class="tab-btn" data-period="3">近3天</button>
                        <button class="tab-btn active" data-period="7">近一周</button>
                        <button class="tab-btn" data-period="30">近一月</button>
                    </div>
                    
                    <!-- 收入统计图 -->
                    <div class="income-chart-container">
                        <div class="income-summary">
                            <div class="summary-item">
                                <span class="summary-value" id="periodIncome">¥0</span>
                                <span class="summary-label">周期收入</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-value" id="totalIncomeValue">¥0</span>
                                <span class="summary-label">累计收入</span>
                            </div>
                        </div>
                        <div class="income-bar-chart" id="incomeBarChart"></div>
                        <div class="income-legend" id="incomeLegend"></div>
                    </div>
                    
                    <!-- 收入明细 -->
                    <div class="income-detail-list" id="incomeDetailList"></div>
                </section>
                
                <section class="incomplete-section">
                    <h2>⚠️ 本周未完成任务</h2>
                    <div class="incomplete-list" id="incompleteList">
                        <p class="empty-hint">暂无未完成任务，太棒了！</p>
                    </div>
                </section>
                
                <section class="history-section">
                    <h2>📝 今日完成记录</h2>
                    <div class="history-list" id="historyList">
                        <p class="empty-hint">还没有完成记录</p>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- 周规划弹窗 -->
    <div id="planModal" class="modal hidden">
        <div class="modal-content plan-modal">
            <div class="modal-header">
                <h2>📅 每周任务规划</h2>
                <button id="closePlanModal" class="btn-close">✕</button>
            </div>
            
            <!-- 每日基础任务 -->
            <div class="plan-section">
                <h3>📋 每日基础任务</h3>
                <p class="section-desc">每天都要完成的固定任务</p>
                <div class="plan-form">
                    <select id="planTaskProject" class="project-select">
                        <option value="">无项目</option>
                    </select>
                    <input type="text" id="planTaskInput" placeholder="输入基础任务名称" maxlength="50">
                    <button id="addPlanTask" class="btn-confirm">添加</button>
                </div>
                <div class="plan-list" id="planTaskList"></div>
            </div>
            
            <!-- 预设当日任务 -->
            <div class="plan-section">
                <h3>📝 预设当日任务</h3>
                <p class="section-desc">提前安排某一天的临时任务</p>
                <div class="plan-form">
                    <select id="presetTaskProject" class="project-select">
                        <option value="">无项目</option>
                    </select>
                    <select id="presetDay" class="day-select">
                        <option value="1">周一</option>
                        <option value="2">周二</option>
                        <option value="3">周三</option>
                        <option value="4">周四</option>
                        <option value="5">周五</option>
                        <option value="6">周六</option>
                        <option value="0">周日</option>
                    </select>
                    <input type="text" id="presetTaskInput" placeholder="输入任务名称" maxlength="50">
                    <button id="addPresetTask" class="btn-confirm">添加</button>
                </div>
                <div class="preset-list" id="presetTaskList"></div>
            </div>
            
            <button id="savePlan" class="btn-primary">完成规划</button>
        </div>
    </div>

    <!-- 月度计划弹窗 -->
    <div id="monthPlanModal" class="modal hidden">
        <div class="modal-content plan-modal">
            <div class="modal-header">
                <h2>📆 本月计划</h2>
                <button id="closeMonthPlanModal" class="btn-close">✕</button>
            </div>
            
            <div class="plan-section">
                <h3>📋 本月目标任务</h3>
                <p class="section-desc">本月要完成的重要任务</p>
                <div class="plan-form">
                    <select id="monthTaskProject" class="project-select">
                        <option value="">无项目</option>
                    </select>
                    <input type="text" id="monthTaskInput" placeholder="输入月度任务" maxlength="100">
                    <button id="addMonthTask" class="btn-confirm">添加</button>
                </div>
                <div class="plan-list" id="monthTaskList"></div>
            </div>
            
            <button id="saveMonthPlan" class="btn-primary">保存计划</button>
        </div>
    </div>

    <!-- 年度计划弹窗 -->
    <div id="yearPlanModal" class="modal hidden">
        <div class="modal-content plan-modal">
            <div class="modal-header">
                <h2>🎯 年度计划</h2>
                <button id="closeYearPlanModal" class="btn-close">✕</button>
            </div>
            
            <div class="plan-section">
                <h3>📋 年度目标任务</h3>
                <p class="section-desc">今年要完成的重要目标</p>
                <div class="plan-form">
                    <select id="yearTaskProject" class="project-select">
                        <option value="">无项目</option>
                    </select>
                    <input type="text" id="yearTaskInput" placeholder="输入年度任务" maxlength="100">
                    <button id="addYearTask" class="btn-confirm">添加</button>
                </div>
                <div class="plan-list" id="yearTaskList"></div>
            </div>
            
            <button id="saveYearPlan" class="btn-primary">保存计划</button>
        </div>
    </div>

    <!-- 复盘弹窗 -->
    <div id="reviewModal" class="modal hidden">
        <div class="modal-content review-modal">
            <div class="modal-header">
                <h2>🔍 任务复盘</h2>
                <button id="closeReviewModal" class="btn-close">✕</button>
            </div>
            <div class="review-date-picker">
                <button id="prevDay" class="btn-nav">◀</button>
                <input type="date" id="reviewDate">
                <button id="nextDay" class="btn-nav">▶</button>
            </div>
            <div class="review-summary" id="reviewSummary"></div>
            <div class="review-content">
                <div class="review-section">
                    <h3>📋 基础任务完成情况</h3>
                    <div id="reviewBaseTasks"></div>
                </div>
                <div class="review-section">
                    <h3>📝 当日任务完成情况</h3>
                    <div id="reviewDailyTasks"></div>
                </div>
                <div class="review-section">
                    <h3>⏰ 完成时间记录</h3>
                    <div id="reviewHistory"></div>
                </div>
                <div class="review-section">
                    <h3>💵 当日收入</h3>
                    <div id="reviewIncome"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 项目管理弹窗 -->
    <div id="projectModal" class="modal hidden">
        <div class="modal-content type-modal">
            <div class="modal-header">
                <h2>📊 项目管理</h2>
                <button id="closeProjectModal" class="btn-close">✕</button>
            </div>
            <div class="type-add-form">
                <input type="text" id="newProjectName" placeholder="项目名称" maxlength="15">
                <input type="color" id="newProjectColor" value="#667eea">
                <button id="addProjectBtn" class="btn-confirm">添加</button>
            </div>
            <div class="type-list" id="projectList"></div>
        </div>
    </div>

    <!-- 数据同步弹窗 -->
    <div id="syncModal" class="modal hidden">
        <div class="modal-content sync-modal">
            <div class="modal-header">
                <h2>☁️ 数据同步</h2>
                <button id="closeSyncModal" class="btn-close">✕</button>
            </div>
            
            <div class="sync-section">
                <h3>📤 导出数据</h3>
                <p class="sync-desc">将所有数据导出为文件，可以在其他设备导入</p>
                <button id="exportDataBtn" class="btn-primary">导出到文件</button>
            </div>
            
            <div class="sync-section">
                <h3>📥 导入数据</h3>
                <p class="sync-desc">从文件导入数据（会覆盖当前数据）</p>
                <input type="file" id="importFileInput" accept=".json" style="display:none;">
                <button id="importDataBtn" class="btn-primary">从文件导入</button>
            </div>
            
            <div class="sync-section">
                <h3>☁️ 浏览器自动同步（推荐）</h3>
                <p class="sync-desc">使用 Edge 浏览器的同步功能，数据自动同步到所有设备</p>
                
                <div class="sync-tips">
                    <p>💡 使用方法：</p>
                    <ul>
                        <li>1. 电脑和手机都安装 Edge 浏览器</li>
                        <li>2. 登录同一个微软账号</li>
                        <li>3. 打开 Edge 设置 → 个人资料 → 同步</li>
                        <li>4. 确保"收藏夹、设置和其他数据"已开启</li>
                        <li>5. 在两台设备上打开本网站，数据会自动同步</li>
                        <li>✅ 完全免费、安全、无需配置</li>
                    </ul>
                </div>
            </div>
            
            <div class="sync-section">
                <h3>🔄 手动同步（备用方案）</h3>
                <p class="sync-desc">如果浏览器同步不可用，可以使用快速同步码</p>
            </div>
            
            <div class="sync-section">
                <h3>🔄 快速同步码</h3>
                <p class="sync-desc">生成同步码，在其他设备输入即可同步</p>
                <div class="sync-code-area">
                    <textarea id="syncCodeOutput" readonly placeholder="点击生成同步码"></textarea>
                    <div class="sync-code-buttons">
                        <button id="generateCodeBtn" class="btn-secondary">生成同步码</button>
                        <button id="copyCodeBtn" class="btn-secondary">复制</button>
                    </div>
                </div>
                <div class="sync-code-area">
                    <textarea id="syncCodeInput" placeholder="粘贴同步码并应用"></textarea>
                    <button id="applyCodeBtn" class="btn-primary">应用同步码</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 收入类型管理弹窗 -->
    <div id="incomeTypeModal" class="modal hidden">
        <div class="modal-content type-modal">
            <div class="modal-header">
                <h2>💵 收入类型管理</h2>
                <button id="closeTypeModal" class="btn-close">✕</button>
            </div>
            <div class="type-add-form">
                <input type="text" id="newTypeName" placeholder="类型名称" maxlength="10">
                <input type="color" id="newTypeColor" value="#667eea">
                <button id="addTypeBtn" class="btn-confirm">添加</button>
            </div>
            <div class="type-list" id="typeList"></div>
        </div>
    </div>

    <!-- 庆祝动画 -->
    <div id="celebration" class="celebration hidden"></div>
    
    <!-- 通用弹窗 -->
    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="modalTitle"></h2>
            <p id="modalMessage"></p>
            <button id="closeModal" class="btn-confirm">好的！</button>
        </div>
    </div>

    <script src="app.js"></script>
    
    <!-- LeanCloud SDK -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>
</body>
</html>
